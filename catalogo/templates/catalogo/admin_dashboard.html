
{% extends 'catalogo/admin_base.html' %}
{% block title %}Administración{% endblock %}
{% block content %}
<nav class="mb-6 border-b">
  <ul class="flex gap-4">
    <li><a href="{% url 'catalogo:admin_dashboard' %}?section=pedidos" class="pb-2 {% if section == 'pedidos' %}font-bold border-b-2 border-blue-500{% endif %}">Pedidos</a></li>
    <li><a href="{% url 'catalogo:admin_dashboard' %}?section=tipo" class="pb-2 {% if section == 'tipo' %}font-bold border-b-2 border-blue-500{% endif %}">Tipos</a></li>
    <li><a href="{% url 'catalogo:admin_dashboard' %}?section=categoria" class="pb-2 {% if section == 'categoria' %}font-bold border-b-2 border-blue-500{% endif %}">Categorías</a></li>
    <li><a href="{% url 'catalogo:admin_dashboard' %}?section=producto" class="pb-2 {% if section == 'producto' %}font-bold border-b-2 border-blue-500{% endif %}">Productos</a></li>
    <li><a href="{% url 'catalogo:admin_dashboard' %}?section=variacion" class="pb-2 {% if section == 'variacion' %}font-bold border-b-2 border-blue-500{% endif %}">Variaciones</a></li>
    <li><a href="{% url 'catalogo:admin_dashboard' %}?section=cliente" class="pb-2 {% if section == 'cliente' %}font-bold border-b-2 border-blue-500{% endif %}">Clientes</a></li>

  </ul>
</nav>
<div class="space-y-8">
  {% if section == 'pedidos' %}
  <h1 class="text-2xl font-bold">Pedidos</h1>
  <table class="min-w-full bg-white text-black rounded shadow">

    <thead><tr><th>ID</th><th>Cliente</th><th>Estado</th><th>Cambiar</th><th>Detalles</th></tr></thead>
    <tbody>
      {% for p in pedidos %}
      <tr class="border-b">
        <td>{{ p.id }}</td>
        <td>{{ p.cliente.nombre }} - {{ p.cliente.telefono }} - {{ p.cliente.direccion }}</td>
        <td>{{ p.get_estado_display }}</td>
        <td>

          <form method="post" action="{% url 'catalogo:actualizar_estado_pedido' p.id %}" class="flex items-center gap-2">
            {% csrf_token %}
            <select name="estado" class="border p-1 text-sm rounded">

              {% for key, val in estados %}
                <option value="{{ key }}" {% if key == p.estado %}selected{% endif %}>{{ val }}</option>
              {% endfor %}
            </select>

            <button class="bg-blue-500 text-white px-2 text-sm rounded">Guardar</button>

          </form>
        </td>
        <td><button class="toggle-items text-blue-600" data-pedido="{{ p.id }}">Ver</button></td>
      </tr>
      <tr class="hidden bg-gray-50" id="pedido-items-{{ p.id }}">
        <td colspan="5">
          <ul class="pl-4 list-disc">
            {% for item in p.items.all %}
            <li>{{ item.cantidad }} x {{ item.variacion.producto.nombre }} ({{ item.variacion.id }})</li>
            {% endfor %}
          </ul>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {% elif section == 'tipo' %}
  <h2 class="text-xl font-bold">Nuevo Tipo de Producto</h2>
  <form method="post" class="space-y-2 bg-white p-4 rounded shadow">
    {% csrf_token %}
    {{ tipo_form.as_p }}
    <button class="bg-green-500 text-white px-4 py-1">Guardar</button>
  </form>
  {% elif section == 'categoria' %}
  <h2 class="text-xl font-bold">Nueva Categoría</h2>
  <form method="post" class="space-y-2 bg-white p-4 rounded shadow">
    {% csrf_token %}
    {{ categoria_form.as_p }}
    <button class="bg-green-500 text-white px-4 py-1">Guardar</button>
  </form>
  {% elif section == 'producto' %}
  <h2 class="text-xl font-bold">Nuevo Producto</h2>
  <form method="post" class="space-y-2 bg-white p-4 rounded shadow">
    {% csrf_token %}
    {{ producto_form.as_p }}
    <button class="bg-green-500 text-white px-4 py-1">Guardar</button>
  </form>
  {% elif section == 'variacion' %}
  <h2 class="text-xl font-bold">Nueva Variación</h2>
  <form method="post" class="space-y-2 bg-white p-4 rounded shadow">
    {% csrf_token %}
    {{ variacion_form.as_p }}
    <button class="bg-green-500 text-white px-4 py-1">Guardar</button>
  </form>
  {% elif section == 'cliente' %}
  <h2 class="text-xl font-bold">Clientes Registrados</h2>
  <table class="min-w-full bg-white text-black rounded shadow">
    <thead>
      <tr><th>ID</th><th>Nombre</th><th>Teléfono</th><th>Dirección</th><th>Ciudad</th></tr>
    </thead>
    <tbody>
      {% for c in clientes %}
      <tr class="border-b">
        <td>{{ c.id }}</td>
        <td>{{ c.nombre }}</td>
        <td>{{ c.telefono }}</td>
        <td>{{ c.direccion }}</td>
        <td>{{ c.ciudad }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        if (document.querySelector('#id_var-valores')) {
            new TomSelect('#id_var-valores', { plugins: ['remove_button'] });
        }
        document.querySelectorAll('.toggle-items').forEach(btn => {
            btn.addEventListener('click', () => {
                const row = document.getElementById(`pedido-items-${btn.dataset.pedido}`);
                row.classList.toggle('hidden');
            });
        });
    });
</script>
{% endblock %}

